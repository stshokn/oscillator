<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>減衰振動シミュレーション</title>
    <style>
        canvas {
            border: 1px solid black;
        }

        .slider-container, .button-container, .info-container {
            margin: 10px 0;
        }

        .slider-container input[type="range"] {
            -webkit-appearance: none; /* ブラウザのデフォルトスタイルをリセット */
            width: 100%;
            height: 50px;
        }

        /* スライダーのトラック部分のスタイル設定 */
        .slider-container input[type="range"]::-webkit-slider-runnable-track {
            height: 30px; /* トラックの縦幅を設定 */
            background: #ddd; /* トラックの背景色 */
            border-radius: 10px; /* トラックの角を丸める */
        }

        /* スライダーのハンドル部分のスタイル設定 */
        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; /* ブラウザのデフォルトスタイルをリセット */
            height: 30px; /* サムの縦幅を設定 */
            width: 20px; /* サムの横幅を設定 */
            background: #333; /* サムの色 */
            border-radius: 20%; /* サムを丸くする */
            cursor: pointer; /* マウスオーバー時にカーソルを変更 */
        }

        .indicator {
            font-size: 24px;
            font-weight: bold;
            color: white;
            background-color: black;
            padding: 10px;
            text-align: center;
            width: 200px;
            margin: 0 auto;
            border-radius: 5px;
        }

        .button-container button {
            font-size: 24px; /* ボタンのフォントサイズを大きく */
            padding: 20px 40px; /* ボタンのパディングを大きくして全体を大きく */
            border-radius: 10px; /* ボタンの角を丸めて見やすく */
        }
    </style>
    <!-- MathJaxの読み込み -->
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <h2>減衰振動シミュレーション</h2>

    <!-- パラメータ設定スライダー -->
    <div class="slider-container">
        <label>質量 (kg): <span id="massValue">1.0</span>
            <input type="range" id="mass" min="0.1" max="5" step="0.1" value="1">
        </label>
    </div>
    <div class="slider-container">
        <label>ばね定数 (N/m): <span id="springConstantValue">10</span>
            <input type="range" id="springConstant" min="1" max="50" step="1" value="10">
        </label>
    </div>
    <div class="slider-container">
        <label>減衰係数(\( \gamma \)) ( \( \sqrt{mk} \) の倍数として設定): <span id="dampingFactorValue">0.00</span>
            <input type="range" id="dampingFactor" min="0" max="3" step="0.2" value="0">
        </label>
    </div>

    <!-- 減衰状態インジケーター -->
    <div class="info-container">
        <div id="dampingStatus" class="indicator">単振動</div>
    </div>

    <!-- 開始ボタン -->
    <div class="button-container">
        <button onclick="startSimulation()">運動開始</button>
    </div>

    <!-- 描画領域 -->
    <canvas id="oscillationCanvas"></canvas>
    <canvas id="displacementGraph"></canvas>

    <script>
        const massSlider = document.getElementById("mass");
        const springConstantSlider = document.getElementById("springConstant");
        const dampingFactorSlider = document.getElementById("dampingFactor");
        const massValue = document.getElementById("massValue");
        const springConstantValue = document.getElementById("springConstantValue");
        const dampingFactorValue = document.getElementById("dampingFactorValue");
        const dampingStatus = document.getElementById("dampingStatus");

        const oscillationCanvas = document.getElementById("oscillationCanvas");
        const displacementGraph = document.getElementById("displacementGraph");
        const ctx = oscillationCanvas.getContext("2d");
        const graphCtx = displacementGraph.getContext("2d");

        let time = 0;
        let running = false;
        let amplitude = 130; // 初期振幅を倍に設定
        let initialPosition = amplitude;

        // ウィンドウのリサイズ時にキャンバスの幅と高さを調整
        window.addEventListener('resize', resizeCanvas);
        window.addEventListener('load', resizeCanvas);

        function resizeCanvas() {
            if (window.innerWidth <= 768) {
                // スマホ用に横幅いっぱいにする
                oscillationCanvas.width = window.innerWidth - 20; // ページの余白を差し引く
                oscillationCanvas.height = 300;
                displacementGraph.width = window.innerWidth - 20;
                displacementGraph.height = 300;
            } else {
                // PC表示時には指定した幅に戻す
                oscillationCanvas.width = 600;
                oscillationCanvas.height = 300;
                displacementGraph.width = 600;
                displacementGraph.height = 300;
            }
        }

        function updateDampingStatus() {
            const mass = parseFloat(massSlider.value);
            const springConstant = parseFloat(springConstantSlider.value);
            const dampingFactor = parseFloat(dampingFactorSlider.value) * Math.sqrt(mass * springConstant);

            const criticalDamping = 2 * Math.sqrt(springConstant * mass);

            let dampingType = '';

            if (dampingFactor === 0) {
                dampingType = '単振動';
                dampingStatus.style.backgroundColor = 'blue';
            } else if (dampingFactor < criticalDamping) {
                dampingType = '減衰振動';
                dampingStatus.style.backgroundColor = 'green';
            } else if (dampingFactor === criticalDamping) {
                dampingType = '臨界減衰';
                dampingStatus.style.backgroundColor = 'yellow';
                dampingStatus.style.color = 'black';
            } else {
                dampingType = '過減衰';
                dampingStatus.style.backgroundColor = 'red';
            }

            dampingStatus.textContent = dampingType;
        }

        function draw() {
            if (!running) return;

            const mass = parseFloat(massSlider.value);
            const springConstant = parseFloat(springConstantSlider.value);
            const dampingFactor = parseFloat(dampingFactorSlider.value) * Math.sqrt(mass * springConstant);

            const omega = Math.sqrt(springConstant / mass);
            const dampingCoeff = dampingFactor / (2 * mass);

            ctx.clearRect(0, 0, oscillationCanvas.width, oscillationCanvas.height);

            // 減衰振動の位置計算 (x = 初期位置 * e^(-dampingCoeff * t) * cos(ω * t))
            const displacement = initialPosition * Math.exp(-dampingCoeff * time) * Math.cos(omega * time);
            const x = oscillationCanvas.width / 2 + displacement;
            const y = oscillationCanvas.height / 2;

            // 水平線を描画（おもりが接する水平面）
            ctx.beginPath();
            ctx.moveTo(0, y + 20);
            ctx.lineTo(oscillationCanvas.width, y + 20);
            ctx.strokeStyle = 'black';
            ctx.stroke();

            // ばねとおもりの描画
            ctx.beginPath();
            ctx.moveTo(50, y);
            for (let i = 1; i <= 10; i++) {
                ctx.lineTo(50 + i * (x - 50) / 10, y + (i % 2 === 0 ? 10 : -10));
            }
            ctx.lineTo(x, y);
            ctx.stroke();

            ctx.beginPath();
            ctx.arc(x, y, 10, 0, Math.PI * 2);
            ctx.fill();

            // グラフ描画のコード（省略）
            
            time += 0.025;
            requestAnimationFrame(draw);
        }

        function startSimulation() {
            time = 0;
            running = true;
            draw();
        }

        function resetSimulation() {
            running = false;
            updateDampingStatus();
        }

        massSlider.addEventListener("input", () => {
            resetSimulation();
            massValue.textContent = massSlider.value;
        });
        springConstantSlider.addEventListener("input", () => {
            resetSimulation();
            springConstantValue.textContent = springConstantSlider.value;
        });
        dampingFactorSlider.addEventListener("input", () => {
            resetSimulation();
            dampingFactorValue.textContent = dampingFactorSlider.value;
        });

        updateDampingStatus();
    </script>
</body>
</html>
